/* Utilities.c generated by valac 0.42.5, the Vala compiler
 * generated from Utilities.vala, do not modify */

/*
* Copyright (c) 2011-2020 NotificationCenter
*
* This program is free software; you can redistribute it and/or
* modify it under the terms of the GNU General Public
* License as published by the Free Software Foundation; either
* version 2 of the License, or (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
* General Public License for more details.
*
* You should have received a copy of the GNU General Public
* License along with this program; if not, write to the
* Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
* Boston, MA 02110-1301 USA
*
* Authored by: Juan Pablo Lozano <libredeb@gmail.com>
*/


#include <glib.h>
#include <glib-object.h>
#include <cairo.h>
#include <float.h>
#include <math.h>
#include <gtk/gtk.h>
#include <gdk-pixbuf/gdk-pixbuf.h>
#include <stdlib.h>
#include <string.h>


#define NOTIFICATION_CENTER_FRONTEND_TYPE_UTILITIES (notification_center_frontend_utilities_get_type ())
#define NOTIFICATION_CENTER_FRONTEND_UTILITIES(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), NOTIFICATION_CENTER_FRONTEND_TYPE_UTILITIES, NotificationCenterFrontendUtilities))
#define NOTIFICATION_CENTER_FRONTEND_UTILITIES_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), NOTIFICATION_CENTER_FRONTEND_TYPE_UTILITIES, NotificationCenterFrontendUtilitiesClass))
#define NOTIFICATION_CENTER_FRONTEND_IS_UTILITIES(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), NOTIFICATION_CENTER_FRONTEND_TYPE_UTILITIES))
#define NOTIFICATION_CENTER_FRONTEND_IS_UTILITIES_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), NOTIFICATION_CENTER_FRONTEND_TYPE_UTILITIES))
#define NOTIFICATION_CENTER_FRONTEND_UTILITIES_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), NOTIFICATION_CENTER_FRONTEND_TYPE_UTILITIES, NotificationCenterFrontendUtilitiesClass))

typedef struct _NotificationCenterFrontendUtilities NotificationCenterFrontendUtilities;
typedef struct _NotificationCenterFrontendUtilitiesClass NotificationCenterFrontendUtilitiesClass;
typedef struct _NotificationCenterFrontendUtilitiesPrivate NotificationCenterFrontendUtilitiesPrivate;
enum  {
	NOTIFICATION_CENTER_FRONTEND_UTILITIES_0_PROPERTY,
	NOTIFICATION_CENTER_FRONTEND_UTILITIES_NUM_PROPERTIES
};
static GParamSpec* notification_center_frontend_utilities_properties[NOTIFICATION_CENTER_FRONTEND_UTILITIES_NUM_PROPERTIES];

#define NOTIFICATION_CENTER_FRONTEND_TYPE_COLOR (notification_center_frontend_color_get_type ())
typedef struct _NotificationCenterFrontendColor NotificationCenterFrontendColor;
#define _g_free0(var) (var = (g_free (var), NULL))

struct _NotificationCenterFrontendUtilities {
	GObject parent_instance;
	NotificationCenterFrontendUtilitiesPrivate * priv;
};

struct _NotificationCenterFrontendUtilitiesClass {
	GObjectClass parent_class;
};

struct _NotificationCenterFrontendColor {
	gdouble R;
	gdouble G;
	gdouble B;
	gdouble A;
};


static gpointer notification_center_frontend_utilities_parent_class = NULL;

GType notification_center_frontend_utilities_get_type (void) G_GNUC_CONST;
void notification_center_frontend_utilities_draw_rounded_rectangle (cairo_t* context,
                                                                    gdouble radius,
                                                                    gdouble offset,
                                                                    GtkAllocation* size);
GType notification_center_frontend_color_get_type (void) G_GNUC_CONST;
NotificationCenterFrontendColor* notification_center_frontend_color_dup (const NotificationCenterFrontendColor* self);
void notification_center_frontend_color_free (NotificationCenterFrontendColor* self);
void notification_center_frontend_utilities_average_color (GdkPixbuf* source,
                                                           NotificationCenterFrontendColor* result);
void notification_center_frontend_color_init (NotificationCenterFrontendColor *self,
                                              gdouble R,
                                              gdouble G,
                                              gdouble B,
                                              gdouble A);
void notification_center_frontend_color_set_val (NotificationCenterFrontendColor *self,
                                                 gdouble val,
                                                 NotificationCenterFrontendColor* result);
void notification_center_frontend_color_multiply_sat (NotificationCenterFrontendColor *self,
                                                      gdouble amount,
                                                      NotificationCenterFrontendColor* result);
void notification_center_frontend_utilities_truncate_text (cairo_t* context,
                                                           GtkAllocation* size,
                                                           guint padding,
                                                           const gchar* input,
                                                           gchar* * truncated,
                                                           cairo_text_extents_t* truncated_extents);
NotificationCenterFrontendUtilities* notification_center_frontend_utilities_new (void);
NotificationCenterFrontendUtilities* notification_center_frontend_utilities_construct (GType object_type);


void
notification_center_frontend_utilities_draw_rounded_rectangle (cairo_t* context,
                                                               gdouble radius,
                                                               gdouble offset,
                                                               GtkAllocation* size)
{
	GtkAllocation _tmp0_;
	gint _tmp1_;
	GtkAllocation _tmp2_;
	gint _tmp3_;
	GtkAllocation _tmp4_;
	gint _tmp5_;
	GtkAllocation _tmp6_;
	gint _tmp7_;
	GtkAllocation _tmp8_;
	gint _tmp9_;
	GtkAllocation _tmp10_;
	gint _tmp11_;
	GtkAllocation _tmp12_;
	gint _tmp13_;
	GtkAllocation _tmp14_;
	gint _tmp15_;
	GtkAllocation _tmp16_;
	gint _tmp17_;
	GtkAllocation _tmp18_;
	gint _tmp19_;
	GtkAllocation _tmp20_;
	gint _tmp21_;
	GtkAllocation _tmp22_;
	gint _tmp23_;
	GtkAllocation _tmp24_;
	gint _tmp25_;
	GtkAllocation _tmp26_;
	gint _tmp27_;
	g_return_if_fail (context != NULL);
	g_return_if_fail (size != NULL);
	_tmp0_ = *size;
	_tmp1_ = _tmp0_.x;
	_tmp2_ = *size;
	_tmp3_ = _tmp2_.y;
	cairo_move_to (context, _tmp1_ + radius, _tmp3_ + offset);
	_tmp4_ = *size;
	_tmp5_ = _tmp4_.x;
	_tmp6_ = *size;
	_tmp7_ = _tmp6_.width;
	_tmp8_ = *size;
	_tmp9_ = _tmp8_.y;
	cairo_arc (context, ((_tmp5_ + _tmp7_) - radius) - offset, (_tmp9_ + radius) + offset, radius, G_PI * 1.5, G_PI * 2);
	_tmp10_ = *size;
	_tmp11_ = _tmp10_.x;
	_tmp12_ = *size;
	_tmp13_ = _tmp12_.width;
	_tmp14_ = *size;
	_tmp15_ = _tmp14_.y;
	_tmp16_ = *size;
	_tmp17_ = _tmp16_.height;
	cairo_arc (context, ((_tmp11_ + _tmp13_) - radius) - offset, ((_tmp15_ + _tmp17_) - radius) - offset, radius, (gdouble) 0, G_PI * 0.5);
	_tmp18_ = *size;
	_tmp19_ = _tmp18_.x;
	_tmp20_ = *size;
	_tmp21_ = _tmp20_.y;
	_tmp22_ = *size;
	_tmp23_ = _tmp22_.height;
	cairo_arc (context, (_tmp19_ + radius) + offset, ((_tmp21_ + _tmp23_) - radius) - offset, radius, G_PI * 0.5, G_PI);
	_tmp24_ = *size;
	_tmp25_ = _tmp24_.x;
	_tmp26_ = *size;
	_tmp27_ = _tmp26_.y;
	cairo_arc (context, (_tmp25_ + radius) + offset, (_tmp27_ + radius) + offset, radius, G_PI, G_PI * 1.5);
}


void
notification_center_frontend_utilities_average_color (GdkPixbuf* source,
                                                      NotificationCenterFrontendColor* result)
{
	gdouble rTotal = 0.0;
	gdouble gTotal = 0.0;
	gdouble bTotal = 0.0;
	guchar* dataPtr = NULL;
	guint8* _tmp0_;
	gdouble pixels = 0.0;
	gint _tmp1_;
	gint _tmp2_;
	gint _tmp3_;
	gint _tmp4_;
	gint _tmp5_;
	gint _tmp6_;
	gdouble _tmp42_;
	gdouble _tmp43_;
	gdouble _tmp44_;
	gdouble _tmp45_;
	gdouble _tmp46_;
	gdouble _tmp47_;
	NotificationCenterFrontendColor _tmp48_ = {0};
	NotificationCenterFrontendColor _tmp49_ = {0};
	NotificationCenterFrontendColor _tmp50_ = {0};
	g_return_if_fail (source != NULL);
	rTotal = (gdouble) 0;
	gTotal = (gdouble) 0;
	bTotal = (gdouble) 0;
	_tmp0_ = gdk_pixbuf_get_pixels (source);
	dataPtr = _tmp0_;
	_tmp1_ = gdk_pixbuf_get_height (source);
	_tmp2_ = _tmp1_;
	_tmp3_ = gdk_pixbuf_get_rowstride (source);
	_tmp4_ = _tmp3_;
	_tmp5_ = gdk_pixbuf_get_n_channels (source);
	_tmp6_ = _tmp5_;
	pixels = (gdouble) ((_tmp2_ * _tmp4_) / _tmp6_);
	{
		gint i = 0;
		i = 0;
		{
			gboolean _tmp7_ = FALSE;
			_tmp7_ = TRUE;
			while (TRUE) {
				gint _tmp9_;
				gdouble _tmp10_;
				guchar r = '\0';
				guchar* _tmp11_;
				guchar _tmp12_;
				guchar g = '\0';
				guchar* _tmp13_;
				guchar _tmp14_;
				guchar b = '\0';
				guchar* _tmp15_;
				guchar _tmp16_;
				guchar max = '\0';
				guchar _tmp17_;
				guchar _tmp18_;
				guchar _tmp19_;
				guchar min = '\0';
				guchar _tmp20_;
				guchar _tmp21_;
				guchar _tmp22_;
				gdouble delta = 0.0;
				guchar _tmp23_;
				guchar _tmp24_;
				gdouble _tmp25_ = 0.0;
				gdouble _tmp26_;
				gdouble sat = 0.0;
				gdouble score = 0.0;
				gdouble _tmp29_;
				gdouble _tmp30_;
				guchar _tmp31_;
				gdouble _tmp32_;
				gdouble _tmp33_;
				guchar _tmp34_;
				gdouble _tmp35_;
				gdouble _tmp36_;
				guchar _tmp37_;
				gdouble _tmp38_;
				guchar* _tmp39_;
				gint _tmp40_;
				gint _tmp41_;
				if (!_tmp7_) {
					gint _tmp8_;
					_tmp8_ = i;
					i = _tmp8_ + 1;
				}
				_tmp7_ = FALSE;
				_tmp9_ = i;
				_tmp10_ = pixels;
				if (!(((gdouble) _tmp9_) < _tmp10_)) {
					break;
				}
				_tmp11_ = dataPtr;
				_tmp12_ = _tmp11_[0];
				r = _tmp12_;
				_tmp13_ = dataPtr;
				_tmp14_ = _tmp13_[1];
				g = _tmp14_;
				_tmp15_ = dataPtr;
				_tmp16_ = _tmp15_[2];
				b = _tmp16_;
				_tmp17_ = r;
				_tmp18_ = g;
				_tmp19_ = b;
				max = (guchar) fmax ((gdouble) _tmp17_, fmax ((gdouble) _tmp18_, (gdouble) _tmp19_));
				_tmp20_ = r;
				_tmp21_ = g;
				_tmp22_ = b;
				min = (guchar) fmin ((gdouble) _tmp20_, fmin ((gdouble) _tmp21_, (gdouble) _tmp22_));
				_tmp23_ = max;
				_tmp24_ = min;
				delta = (gdouble) (_tmp23_ - _tmp24_);
				_tmp26_ = delta;
				if (_tmp26_ == ((gdouble) 0)) {
					_tmp25_ = (gdouble) 0;
				} else {
					gdouble _tmp27_;
					guchar _tmp28_;
					_tmp27_ = delta;
					_tmp28_ = max;
					_tmp25_ = _tmp27_ / _tmp28_;
				}
				sat = _tmp25_;
				_tmp29_ = sat;
				score = 0.2 + (0.8 * _tmp29_);
				_tmp30_ = rTotal;
				_tmp31_ = r;
				_tmp32_ = score;
				rTotal = _tmp30_ + (_tmp31_ * _tmp32_);
				_tmp33_ = gTotal;
				_tmp34_ = g;
				_tmp35_ = score;
				gTotal = _tmp33_ + (_tmp34_ * _tmp35_);
				_tmp36_ = bTotal;
				_tmp37_ = b;
				_tmp38_ = score;
				bTotal = _tmp36_ + (_tmp37_ * _tmp38_);
				_tmp39_ = dataPtr;
				_tmp40_ = gdk_pixbuf_get_n_channels (source);
				_tmp41_ = _tmp40_;
				dataPtr = _tmp39_ + _tmp41_;
			}
		}
	}
	_tmp42_ = rTotal;
	_tmp43_ = pixels;
	_tmp44_ = gTotal;
	_tmp45_ = pixels;
	_tmp46_ = bTotal;
	_tmp47_ = pixels;
	notification_center_frontend_color_init (&_tmp48_, (_tmp42_ / G_MAXUINT8) / _tmp43_, (_tmp44_ / G_MAXUINT8) / _tmp45_, (_tmp46_ / G_MAXUINT8) / _tmp47_, (gdouble) 1);
	notification_center_frontend_color_set_val (&_tmp48_, 0.8, &_tmp49_);
	notification_center_frontend_color_multiply_sat (&_tmp49_, 1.15, &_tmp50_);
	*result = _tmp50_;
	return;
}


static gchar*
string_slice (const gchar* self,
              glong start,
              glong end)
{
	gchar* result = NULL;
	glong string_length = 0L;
	gint _tmp0_;
	gint _tmp1_;
	gboolean _tmp4_ = FALSE;
	gboolean _tmp6_ = FALSE;
	gchar* _tmp8_;
	g_return_val_if_fail (self != NULL, NULL);
	_tmp0_ = strlen (self);
	_tmp1_ = _tmp0_;
	string_length = (glong) _tmp1_;
	if (start < ((glong) 0)) {
		glong _tmp2_;
		_tmp2_ = string_length;
		start = _tmp2_ + start;
	}
	if (end < ((glong) 0)) {
		glong _tmp3_;
		_tmp3_ = string_length;
		end = _tmp3_ + end;
	}
	if (start >= ((glong) 0)) {
		glong _tmp5_;
		_tmp5_ = string_length;
		_tmp4_ = start <= _tmp5_;
	} else {
		_tmp4_ = FALSE;
	}
	g_return_val_if_fail (_tmp4_, NULL);
	if (end >= ((glong) 0)) {
		glong _tmp7_;
		_tmp7_ = string_length;
		_tmp6_ = end <= _tmp7_;
	} else {
		_tmp6_ = FALSE;
	}
	g_return_val_if_fail (_tmp6_, NULL);
	g_return_val_if_fail (start <= end, NULL);
	_tmp8_ = g_strndup (((gchar*) self) + start, (gsize) (end - start));
	result = _tmp8_;
	return result;
}


void
notification_center_frontend_utilities_truncate_text (cairo_t* context,
                                                      GtkAllocation* size,
                                                      guint padding,
                                                      const gchar* input,
                                                      gchar* * truncated,
                                                      cairo_text_extents_t* truncated_extents)
{
	gchar* _vala_truncated = NULL;
	cairo_text_extents_t _vala_truncated_extents = {0};
	cairo_text_extents_t extents = {0};
	gchar* _tmp0_;
	cairo_text_extents_t _tmp1_ = {0};
	cairo_text_extents_t _tmp2_;
	gdouble _tmp3_;
	GtkAllocation _tmp4_;
	gint _tmp5_;
	const gchar* _tmp24_;
	cairo_text_extents_t _tmp25_ = {0};
	g_return_if_fail (context != NULL);
	g_return_if_fail (size != NULL);
	g_return_if_fail (input != NULL);
	_tmp0_ = g_strdup (input);
	_g_free0 (_vala_truncated);
	_vala_truncated = _tmp0_;
	cairo_text_extents (context, input, &_tmp1_);
	extents = _tmp1_;
	_tmp2_ = extents;
	_tmp3_ = _tmp2_.width;
	_tmp4_ = *size;
	_tmp5_ = _tmp4_.width;
	if (_tmp3_ > ((gdouble) (_tmp5_ - padding))) {
		const gchar* _tmp17_;
		const gchar* _tmp18_;
		gint _tmp19_;
		gint _tmp20_;
		gchar* _tmp21_;
		const gchar* _tmp22_;
		gchar* _tmp23_;
		while (TRUE) {
			cairo_text_extents_t _tmp6_;
			gdouble _tmp7_;
			GtkAllocation _tmp8_;
			gint _tmp9_;
			const gchar* _tmp10_;
			const gchar* _tmp11_;
			gint _tmp12_;
			gint _tmp13_;
			gchar* _tmp14_;
			const gchar* _tmp15_;
			cairo_text_extents_t _tmp16_ = {0};
			_tmp6_ = extents;
			_tmp7_ = _tmp6_.width;
			_tmp8_ = *size;
			_tmp9_ = _tmp8_.width;
			if (!(_tmp7_ > ((gdouble) (_tmp9_ - padding)))) {
				break;
			}
			_tmp10_ = _vala_truncated;
			_tmp11_ = _vala_truncated;
			_tmp12_ = strlen (_tmp11_);
			_tmp13_ = _tmp12_;
			_tmp14_ = string_slice (_tmp10_, (glong) 0, (glong) (((gint) _tmp13_) - 1));
			_g_free0 (_vala_truncated);
			_vala_truncated = _tmp14_;
			_tmp15_ = _vala_truncated;
			cairo_text_extents (context, _tmp15_, &_tmp16_);
			extents = _tmp16_;
		}
		_tmp17_ = _vala_truncated;
		_tmp18_ = _vala_truncated;
		_tmp19_ = strlen (_tmp18_);
		_tmp20_ = _tmp19_;
		_tmp21_ = string_slice (_tmp17_, (glong) 0, (glong) (((gint) _tmp20_) - 3));
		_g_free0 (_vala_truncated);
		_vala_truncated = _tmp21_;
		_tmp22_ = _vala_truncated;
		_tmp23_ = g_strconcat (_tmp22_, "...", NULL);
		_g_free0 (_vala_truncated);
		_vala_truncated = _tmp23_;
	}
	_tmp24_ = _vala_truncated;
	cairo_text_extents (context, _tmp24_, &_tmp25_);
	_vala_truncated_extents = _tmp25_;
	if (truncated) {
		*truncated = _vala_truncated;
	} else {
		_g_free0 (_vala_truncated);
	}
	if (truncated_extents) {
		*truncated_extents = _vala_truncated_extents;
	}
}


NotificationCenterFrontendUtilities*
notification_center_frontend_utilities_construct (GType object_type)
{
	NotificationCenterFrontendUtilities * self = NULL;
	self = (NotificationCenterFrontendUtilities*) g_object_new (object_type, NULL);
	return self;
}


NotificationCenterFrontendUtilities*
notification_center_frontend_utilities_new (void)
{
	return notification_center_frontend_utilities_construct (NOTIFICATION_CENTER_FRONTEND_TYPE_UTILITIES);
}


static void
notification_center_frontend_utilities_class_init (NotificationCenterFrontendUtilitiesClass * klass)
{
	notification_center_frontend_utilities_parent_class = g_type_class_peek_parent (klass);
}


static void
notification_center_frontend_utilities_instance_init (NotificationCenterFrontendUtilities * self)
{
}


GType
notification_center_frontend_utilities_get_type (void)
{
	static volatile gsize notification_center_frontend_utilities_type_id__volatile = 0;
	if (g_once_init_enter (&notification_center_frontend_utilities_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (NotificationCenterFrontendUtilitiesClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) notification_center_frontend_utilities_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (NotificationCenterFrontendUtilities), 0, (GInstanceInitFunc) notification_center_frontend_utilities_instance_init, NULL };
		GType notification_center_frontend_utilities_type_id;
		notification_center_frontend_utilities_type_id = g_type_register_static (G_TYPE_OBJECT, "NotificationCenterFrontendUtilities", &g_define_type_info, 0);
		g_once_init_leave (&notification_center_frontend_utilities_type_id__volatile, notification_center_frontend_utilities_type_id);
	}
	return notification_center_frontend_utilities_type_id__volatile;
}



